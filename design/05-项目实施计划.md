# 项目实施计划

## 1. 开发阶段划分

### Phase 1: 基础设施搭建（预计3天）

#### 1.1 项目初始化（已完成✅）
- [x] 创建项目目录结构
- [x] 初始化Go后端项目（Nunu框架）
- [x] 初始化Vue3前端项目
- [x] 配置Git版本控制

#### 1.2 数据库环境搭建（待完成）
- [ ] 安装PostgreSQL数据库
- [ ] 创建开发数据库
- [ ] 执行数据库初始化脚本
- [ ] 配置数据库连接

#### 1.3 开发环境配置（待完成）
- [ ] 配置后端开发环境（config/local.yml）
- [ ] 配置前端开发环境
- [ ] 配置Docker Compose（可选）
- [ ] 配置代码规范工具（golangci-lint, eslint）

### Phase 2: 核心功能开发（预计10天）

#### 2.1 用户模块开发（2天）
**后端任务：**
- [ ] 定义User模型（internal/model/user.go）
- [ ] 实现用户Repository（internal/repository/user.go）
- [ ] 实现用户Service（internal/service/user.go）
  - 用户注册
  - 用户登录（JWT生成）
  - 获取用户信息
  - 修改密码
- [ ] 实现用户Handler（internal/handler/user.go）
- [ ] 注册用户路由（internal/router/router.go）
- [ ] 实现JWT中间件（internal/middleware/jwt.go）
- [ ] 更新Wire依赖注入配置
- [ ] 生成Swagger文档

**前端任务：**
- [ ] 实现登录页面（Login.vue）
- [ ] 实现注册页面（Register.vue）
- [ ] 实现用户信息管理页面
- [ ] 配置API请求封装（axios）
- [ ] 实现Token存储和自动刷新

**测试任务：**
- [ ] 编写用户注册测试
- [ ] 编写用户登录测试
- [ ] 编写JWT认证测试

#### 2.2 货架模块开发（2天）
**后端任务：**
- [ ] 定义Shelf模型（internal/model/shelf.go）
- [ ] 实现货架Repository（internal/repository/shelf.go）
- [ ] 实现货架Service（internal/service/shelf.go）
  - 创建货架
  - 查询货架列表
  - 更新货架信息
  - 删除货架
  - 货架统计
- [ ] 实现货架Handler（internal/handler/shelf.go）
- [ ] 注册货架路由
- [ ] 更新Wire配置
- [ ] 生成Swagger文档

**前端任务：**
- [ ] 实现货架管理页面（ShelfManagement.vue）
- [ ] 实现货架列表展示
- [ ] 实现货架增删改查表单
- [ ] 实现货架可视化展示（可选）

**数据初始化：**
- [ ] 创建测试货架数据脚本

#### 2.3 包裹模块开发（4天）
**后端任务：**
- [ ] 定义Parcel模型（internal/model/parcel.go）
- [ ] 实现包裹Repository（internal/repository/parcel.go）
- [ ] 实现取件码生成器（pkg/pickupcode/generator.go）
- [ ] 实现货架分配算法（pkg/allocation/shelf_allocator.go）
- [ ] 实现包裹Service（internal/service/parcel.go）
  - 包裹入库（自动分配货架、生成取件码）
  - 包裹上架
  - 包裹取件
  - 包裹查询（取件码、快递单号、手机号）
  - 包裹列表（分页、过滤）
  - 包裹退回
- [ ] 实现状态流转验证器（pkg/status/validator.go）
- [ ] 实现包裹Handler（internal/handler/parcel.go）
- [ ] 注册包裹路由
- [ ] 更新Wire配置
- [ ] 生成Swagger文档

**前端任务：**
- [ ] 实现包裹入库页面（ParcelReceive.vue）
- [ ] 实现包裹列表页面（ParcelList.vue）
- [ ] 实现包裹详情页面（ParcelDetail.vue）
- [ ] 实现包裹查询页面（ParcelQuery.vue）
- [ ] 实现取件页面（ParcelPickup.vue）
- [ ] 实现我的包裹页面（MyParcels.vue）

**测试任务：**
- [ ] 编写包裹入库测试
- [ ] 编写取件码生成测试
- [ ] 编写货架分配算法测试
- [ ] 编写包裹状态流转测试
- [ ] 编写包裹查询测试

#### 2.4 寄件模块开发（2天）
**后端任务：**
- [ ] 定义Shipment模型（internal/model/shipment.go）
- [ ] 定义CourierPrice模型（internal/model/courier_price.go）
- [ ] 实现寄件Repository（internal/repository/shipment.go）
- [ ] 实现运费Repository（internal/repository/courier_price.go）
- [ ] 实现运费计算器（pkg/freight/calculator.go）
- [ ] 实现寄件Service（internal/service/shipment.go）
  - 创建寄件单
  - 查询寄件单
  - 运费计算
- [ ] 实现寄件Handler（internal/handler/shipment.go）
- [ ] 注册寄件路由
- [ ] 更新Wire配置
- [ ] 生成Swagger文档

**前端任务：**
- [ ] 实现寄件下单页面（ShipmentCreate.vue）
- [ ] 实现运费试算功能
- [ ] 实现我的寄件单页面（MyShipments.vue）
- [ ] 实现寄件单详情页面

**数据初始化：**
- [ ] 初始化快递公司价格配置

### Phase 3: 高级功能开发（预计5天）

#### 3.1 滞留件处理模块（2天）
**后端任务：**
- [ ] 定义OverdueRecord模型（internal/model/overdue_record.go）
- [ ] 实现滞留记录Repository（internal/repository/overdue_record.go）
- [ ] 实现滞留扫描服务（internal/job/overdue_scanner.go）
- [ ] 实现通知服务接口（internal/service/notification.go）
- [ ] 实现滞留Handler（internal/handler/overdue.go）
- [ ] 配置定时任务（使用gocron）
- [ ] 注册滞留路由
- [ ] 更新Wire配置

**前端任务：**
- [ ] 实现滞留件列表页面（OverdueParcels.vue）
- [ ] 实现滞留提醒功能
- [ ] 实现批量退回功能

**测试任务：**
- [ ] 编写滞留扫描测试
- [ ] 编写滞留费用计算测试

#### 3.2 统计分析模块（2天）
**后端任务：**
- [ ] 实现统计Repository（internal/repository/statistics.go）
- [ ] 实现统计Service（internal/service/statistics.go）
  - 仪表盘统计
  - 包裹统计
  - 货架统计
  - 数据导出
- [ ] 实现统计Handler（internal/handler/statistics.go）
- [ ] 注册统计路由
- [ ] 更新Wire配置

**前端任务：**
- [ ] 实现仪表盘页面（Dashboard.vue）
- [ ] 实现数据可视化（ECharts）
- [ ] 实现统计报表页面（Statistics.vue）
- [ ] 实现数据导出功能

#### 3.3 操作日志模块（1天）
**后端任务：**
- [ ] 定义OperationLog模型（internal/model/operation_log.go）
- [ ] 实现日志Repository（internal/repository/operation_log.go）
- [ ] 实现日志中间件（internal/middleware/logger.go）
- [ ] 实现日志Handler（internal/handler/log.go）
- [ ] 注册日志路由
- [ ] 更新Wire配置

**前端任务：**
- [ ] 实现操作日志页面（OperationLogs.vue）
- [ ] 实现日志查询和过滤

### Phase 4: 前端完善（预计3天）

#### 4.1 布局和导航（1天）
- [ ] 实现主布局组件（Layout.vue）
- [ ] 实现顶部导航栏
- [ ] 实现侧边菜单
- [ ] 实现面包屑导航
- [ ] 配置路由守卫

#### 4.2 权限控制（1天）
- [ ] 实现基于角色的菜单显示
- [ ] 实现按钮级权限控制
- [ ] 实现路由权限控制

#### 4.3 用户体验优化（1天）
- [ ] 统一错误处理
- [ ] 添加Loading状态
- [ ] 添加操作确认对话框
- [ ] 添加成功/失败提示
- [ ] 响应式设计优化

### Phase 5: 测试与优化（预计4天）

#### 5.1 单元测试（2天）
- [ ] 完善Repository层测试
- [ ] 完善Service层测试
- [ ] 完善Handler层测试
- [ ] 测试覆盖率达到80%以上

#### 5.2 集成测试（1天）
- [ ] 编写端到端测试（使用httpexpect）
- [ ] 测试完整业务流程
  - 包裹入库→上架→取件流程
  - 寄件流程
  - 滞留处理流程

#### 5.3 性能测试与优化（1天）
- [ ] 使用压测工具测试API性能
- [ ] 优化慢查询SQL
- [ ] 添加缓存（Redis，可选）
- [ ] 优化前端性能（懒加载、代码分割）

### Phase 6: 部署与文档（预计3天）

#### 6.1 部署准备（1天）
- [ ] 配置生产环境配置文件（config/prod.yml）
- [ ] 准备生产环境数据库
- [ ] 编写数据库迁移脚本
- [ ] 配置Docker镜像
- [ ] 编写docker-compose.yml

#### 6.2 部署实施（1天）
- [ ] 部署PostgreSQL数据库
- [ ] 部署后端服务
- [ ] 部署前端静态文件（Nginx）
- [ ] 配置反向代理
- [ ] 配置HTTPS（可选）

#### 6.3 文档编写（1天）
- [ ] 编写用户手册
- [ ] 编写部署文档
- [ ] 完善API文档（Swagger）
- [ ] 编写数据库说明文档
- [ ] 编写课程设计报告

## 2. 开发规范

### 2.1 代码规范

#### Go代码规范
- 遵循Go官方代码规范
- 使用golangci-lint进行代码检查
- 函数命名：驼峰命名法（CreateParcel, GetByID）
- 包命名：小写单词（model, service, repository）
- 注释要求：导出函数必须有注释，Swagger注解完整

#### Vue代码规范
- 组件命名：大驼峰（ParcelList.vue）
- 变量命名：小驼峰（parcelList）
- 使用TypeScript类型注解
- 使用ESLint进行代码检查

### 2.2 Git提交规范

使用约定式提交（Conventional Commits）：
```
feat: 新功能
fix: 修复bug
docs: 文档更新
style: 代码格式调整
refactor: 重构
test: 测试相关
chore: 构建/工具链相关
```

示例：
```
feat(parcel): 实现包裹入库功能
fix(auth): 修复JWT token过期问题
docs(api): 更新API文档
test(parcel): 添加包裹查询测试
```

### 2.3 分支管理

- `main`: 主分支，保护分支
- `develop`: 开发分支
- `feature/*`: 功能分支（如：feature/parcel-receive）
- `bugfix/*`: 修复分支
- `release/*`: 发布分支

工作流：
1. 从develop创建feature分支
2. 完成功能开发和测试
3. 提交Pull Request到develop
4. Code Review通过后合并
5. 准备发布时创建release分支
6. 测试通过后合并到main

### 2.4 测试规范

- 单元测试覆盖率要求：80%以上
- 测试文件命名：`xxx_test.go`
- 测试函数命名：`TestXxx`
- 使用表驱动测试（Table-Driven Tests）
- Mock使用mockgen生成

## 3. 技术难点与解决方案

### 3.1 货架分配算法
**难点**：高并发场景下货架分配冲突

**解决方案**：
1. 使用数据库行级锁（FOR UPDATE）
2. 使用乐观锁（版本号）
3. 高并发场景使用分布式锁（Redis）

### 3.2 取件码唯一性
**难点**：随机生成的取件码可能冲突

**解决方案**：
1. 数据库唯一索引保证最终一致性
2. 生成后立即校验，失败重试
3. 使用足够大的字符空间降低碰撞概率

### 3.3 查询性能优化
**难点**：海量包裹数据的快速检索

**解决方案**：
1. 合理设计索引（单列、复合、部分索引）
2. 使用游标分页代替偏移分页
3. 历史数据分区存储
4. 热点数据缓存

### 3.4 事务一致性
**难点**：包裹取件涉及多表更新

**解决方案**：
1. 使用数据库事务保证原子性
2. 关键操作使用行级锁
3. 幂等性设计
4. 失败重试和补偿机制

## 4. 开发工具和资源

### 4.1 开发工具
- **IDE**: GoLand / VS Code
- **数据库工具**: DBeaver / DataGrip
- **API测试**: Postman / Swagger UI
- **版本控制**: Git + GitHub/GitLab
- **容器化**: Docker + Docker Compose

### 4.2 依赖包

#### 后端依赖
```go
github.com/gin-gonic/gin              // Web框架
github.com/golang-jwt/jwt/v5          // JWT认证
github.com/spf13/viper                // 配置管理
go.uber.org/zap                       // 日志
gorm.io/gorm                          // ORM
gorm.io/driver/postgres               // PostgreSQL驱动
github.com/google/wire                // 依赖注入
github.com/swaggo/swag                // Swagger文档
github.com/go-co-op/gocron            // 定时任务
github.com/stretchr/testify           // 测试断言
github.com/golang/mock                // Mock生成
```

#### 前端依赖
```json
{
  "vue": "^3.3.0",
  "vue-router": "^4.2.0",
  "pinia": "^2.1.0",
  "axios": "^1.5.0",
  "naive-ui": "^2.35.0",
  "echarts": "^5.4.0",
  "typescript": "^5.2.0"
}
```

### 4.3 学习资源

#### Go语言
- Go官方文档：https://go.dev/doc/
- Effective Go：https://go.dev/doc/effective_go
- GORM文档：https://gorm.io/docs/

#### PostgreSQL
- PostgreSQL官方文档：https://www.postgresql.org/docs/
- 索引优化指南
- 查询性能优化

#### Vue 3
- Vue 3官方文档：https://vuejs.org/
- Naive UI文档：https://www.naiveui.com/
- Pinia文档：https://pinia.vuejs.org/

## 5. 里程碑检查点

### Milestone 1: 基础功能完成（第1周末）
✅ 检查点：
- 用户注册登录功能正常
- 货架管理功能完整
- 包裹入库和查询功能正常

### Milestone 2: 核心流程打通（第2周末）
✅ 检查点：
- 完整的包裹收发流程可用
- 寄件功能正常
- 基本测试通过

### Milestone 3: 高级功能完成（第3周末）
✅ 检查点：
- 滞留件自动处理
- 统计报表功能
- 前端页面完整

### Milestone 4: 测试优化完成（第4周）
✅ 检查点：
- 测试覆盖率达标
- 性能测试通过
- 部署成功

## 6. 风险管理

### 6.1 技术风险
| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| PostgreSQL配置问题 | 中 | 中 | 提前准备Docker环境，降级使用SQLite |
| 性能不达标 | 中 | 高 | 预留性能优化时间，准备缓存方案 |
| 依赖包兼容性 | 低 | 中 | 使用稳定版本，提前测试 |

### 6.2 进度风险
| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 需求变更 | 中 | 高 | 确定MVP范围，额外需求放入后续迭代 |
| 时间不足 | 中 | 高 | 优先核心功能，次要功能可选实现 |
| 技术难题 | 中 | 中 | 提前调研，预留buffer时间 |

### 6.3 质量风险
| 风险 | 概率 | 影响 | 应对措施 |
|------|------|------|----------|
| 测试不充分 | 中 | 高 | 强制要求测试覆盖率，及时发现问题 |
| 数据一致性问题 | 低 | 高 | 使用事务，完善约束和触发器 |
| 安全漏洞 | 低 | 高 | Code Review，使用参数化查询 |

## 7. 交付物清单

### 7.1 代码交付
- [ ] 后端源代码（Go）
- [ ] 前端源代码（Vue 3）
- [ ] 数据库脚本（SQL）
- [ ] 配置文件示例
- [ ] Docker配置文件

### 7.2 文档交付
- [ ] 课程设计报告（PDF，3000字以上）
- [ ] 系统设计文档
- [ ] API接口文档（Swagger）
- [ ] 数据库设计文档
- [ ] 部署文档
- [ ] 用户手册

### 7.3 演示交付
- [ ] 系统演示视频（可选）
- [ ] 演示PPT
- [ ] 测试报告
- [ ] 系统截图

## 8. 每日开发建议

### 第一天
- 搭建PostgreSQL环境
- 执行数据库初始化脚本
- 测试数据库连接

### 第二天
- 实现用户注册登录功能（后端）
- 实现JWT中间件
- 测试认证流程

### 第三天
- 实现登录注册页面（前端）
- 完成前后端联调
- 实现Token存储

### 第四天
- 实现货架管理功能（后端）
- 编写货架管理测试

### 第五天
- 实现货架管理页面（前端）
- 初始化测试货架数据

### 第六天
- 实现包裹入库功能（后端）
- 实现取件码生成器
- 实现货架分配算法

### 第七天
- 实现包裹查询和取件功能（后端）
- 编写包裹相关测试

### 第八天
- 实现包裹入库页面（前端）
- 实现包裹查询页面

### 第九天
- 实现包裹列表和详情页面（前端）
- 实现取件页面

### 第十天
- 实现寄件功能（后端）
- 实现运费计算器

### 第十一天
- 实现寄件页面（前端）
- 完成前后端联调

### 第十二天
- 实现滞留件处理（后端）
- 配置定时任务

### 第十三天
- 实现滞留件页面（前端）
- 测试滞留流程

### 第十四天
- 实现统计分析功能（后端）

### 第十五天
- 实现仪表盘页面（前端）
- 实现数据可视化

### 第十六天
- 实现操作日志功能
- 完善前端布局和导航

### 第十七天
- 编写单元测试
- 提高测试覆盖率

### 第十八天
- 编写集成测试
- 测试完整流程

### 第十九天
- 性能测试和优化
- 修复发现的bug

### 第二十天
- 准备部署环境
- 部署系统

### 第二十一天
- 编写用户手册
- 编写部署文档

### 第二十二天
- 完善API文档
- 准备演示材料

### 第二十三天
- 编写课程设计报告

### 第二十四天
- 录制演示视频
- 整理提交材料

### 第二十五天
- 最终检查
- 准备答辩

## 9. 成功标准

### 9.1 功能完整性
- ✅ 所有核心功能正常运行
- ✅ 包裹收发流程完整
- ✅ 滞留件自动处理
- ✅ 统计报表功能完整

### 9.2 性能指标
- ✅ 取件码查询响应时间 < 100ms
- ✅ 包裹列表查询响应时间 < 200ms
- ✅ 系统支持1000+并发用户
- ✅ 数据库查询使用索引

### 9.3 质量标准
- ✅ 单元测试覆盖率 > 80%
- ✅ 无严重bug
- ✅ 代码通过静态检查
- ✅ API文档完整

### 9.4 文档标准
- ✅ 课程设计报告 > 3000字
- ✅ 包含E-R图、表结构设计
- ✅ 包含核心代码说明
- ✅ 包含测试结果

## 10. 总结

本实施计划提供了一个清晰的开发路线图，从基础设施搭建到最终部署，共分为6个阶段，预计25天完成。计划强调：

1. **循序渐进**：从简单到复杂，先核心后扩展
2. **测试驱动**：每个模块完成后立即测试
3. **文档同步**：开发过程中同步更新文档
4. **风险管理**：识别风险并提前准备应对措施
5. **质量保证**：明确的成功标准和检查点

按照此计划执行，可以高效完成课程设计项目，并获得一个高质量的交付成果。
